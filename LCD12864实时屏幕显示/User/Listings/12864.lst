C251 COMPILER V5.60.0,  12864                                                              21/04/24  18:50:23  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE 12864
OBJECT MODULE PLACED IN .\Objects\12864.obj
COMPILER INVOKED BY: D:\Keil_v5\C251\BIN\C251.EXE ..\Driver\12864.c INTR2 BROWSE INCDIR(..\Driver) DEBUG PRINT(.\Listing
                    -s\12864.lst) TABS(2) OBJECT(.\Objects\12864.obj) 

stmt  level    source

    1          #include "12864.h"
    2          #include <intrins.h>
    3          /*******************************************************************************
    4          * 函 数 名         : Delay             经测试最低可以只延时5微秒
    5          * 函数功能         : 延时5微秒
    6          *******************************************************************************/
    7          void Delay(void)  //@33.1776MHz
    8          {
    9   1        unsigned long edata i;
   10   1      
   11   1        _nop_();
   12   1        i = 40UL;
   13   1        while (i) i--;
   14   1      }
   15           
   16          /*******************************************************************************
   17          * 函 数 名         : LCD12864_Busy
   18          * 函数功能         : 检测LCD是否忙
   19          * 输    出         : 1或0（1表示不忙，0表示忙）
   20          *******************************************************************************/
   21          uchar LCD12864_Busy(void)
   22          {
   23   1        uchar i = 0;
   24   1        LCD12864_RS = 0;     //选择命令
   25   1        LCD12864_RW = 1;  //选择读取
   26   1        LCD12864_EN = 1;
   27   1        Delay();
   28   1        while((LCD12864_DATAPORT & 0x80) == 0x80)  //检测读取到的值
   29   1        {
   30   2          i++;
   31   2          if(i > 100)
   32   2          {
   33   3            LCD12864_EN = 0;
   34   3            return 0;     //超过等待时间返回0表示失败
   35   3          }
   36   2        }
   37   1        LCD12864_EN = 0;
   38   1        return 1;
   39   1      }
   40           
   41          /*******************************************************************************
   42          * 函 数 名         : LCD12864_WriteCmd
   43          * 函数功能         : 写命令
   44          *******************************************************************************/
   45          void LCD12864_WriteCmd(uchar cmd)
   46          {
   47   1        uchar i;
   48   1        i = 0;
   49   1        while( LCD12864_Busy() == 0)
   50   1        {
   51   2          Delay();
   52   2          i++;
   53   2          if( i>100)
   54   2          {
   55   3            return;     //超过等待退出
   56   3          }  
   57   2        } 
   58   1        LCD12864_RS = 0;     //选择命令
C251 COMPILER V5.60.0,  12864                                                              21/04/24  18:50:23  PAGE 2   

   59   1        LCD12864_RW = 0;     //选择写入
   60   1        LCD12864_EN = 0;     //初始化使能端
   61   1        LCD12864_DATAPORT = cmd;   //放置数据
   62   1        LCD12864_EN = 1;       //写时序
   63   1        Delay();
   64   1        LCD12864_EN = 0;              
   65   1      }
   66           
   67          /*******************************************************************************
   68          * 函 数 名         : LCD12864_WriteData
   69          * 函数功能         : 写数据
   70          *******************************************************************************/
   71          void LCD12864_WriteData(uchar dat)
   72          {
   73   1        uchar i;
   74   1        i = 0;
   75   1        while( LCD12864_Busy() == 0)
   76   1        {
   77   2          Delay();
   78   2          i++;
   79   2          if( i>100)
   80   2          {
   81   3            return;     //超过等待退出
   82   3          }  
   83   2        }
   84   1        LCD12864_RS = 1;     //选择数据
   85   1        LCD12864_RW = 0;     //选择写入
   86   1        LCD12864_EN = 0;     //初始化使能端
   87   1        LCD12864_DATAPORT = dat;   //放置数据
   88   1        LCD12864_EN = 1;       //写时序
   89   1        Delay();
   90   1        LCD12864_EN = 0;                    
   91   1      }
   92           
   93          /*******************************************************************************
   94          * 函 数 名         : LCD12864_Init
   95          * 函数功能         : 初始化
   96          *******************************************************************************/
   97          void LCD12864_Init()
   98          {
   99   1        LCD12864_PSB = 1;    //选择并行输入
  100   1        LCD12864_RST = 0;    //复位
  101   1        LCD12864_RST = 1;    //复位
  102   1        LCD12864_WriteCmd(0x01);  //清除LCD12864的显示内容
  103   1        LCD12864_WriteCmd(0x02);
  104   1        LCD12864_WriteCmd(0x0c);  //显示开，关光标
  105   1        LCD12864_WriteCmd(0x80);
  106   1        //LCD12864_WriteCmd(0x34);  //打开扩充指令
  107   1        LCD12864_WriteCmd(0x30);  //选择基本指令操作
  108   1      }
  109           
  110          /*******************************************************************************
  111          * 函 数 名         : LCD12864_Word
  112          * 函数功能         : 打字，一行十六个，一共四行
  113          *******************************************************************************/
  114          void LCD12864_Word(uchar x, uchar y,uchar *word)
  115          {
  116   1        uchar pos;
  117   1        uchar i=y;
  118   1      
  119   1        if(x == 0)     // 第一行的地址是80H
  120   1        {
  121   2          x = 0x80;
  122   2        }    
  123   1        else if(x == 1)  //第二行的地址是90H
  124   1        {
C251 COMPILER V5.60.0,  12864                                                              21/04/24  18:50:23  PAGE 3   

  125   2          x = 0x90;  
  126   2        }  
  127   1        else if(x == 2)  //第三行的地址是88H
  128   1        {
  129   2          x = 0x88;
  130   2        }  
  131   1        else if(x == 3)  //第三行的地址是98H
  132   1        {
  133   2          x = 0x98;
  134   2        }  
  135   1        pos = x + y;
  136   1        LCD12864_WriteCmd(pos);  
  137   1        while(word[i]!='\0')
  138   1        {
  139   2          if(i<16)    //判断是否在本行的显示范围内
  140   2          {
  141   3            LCD12864_WriteData(word[i]);
  142   3            i++;
  143   3          }  
  144   2         }
  145   1      }
  146          /*******************************************************************************
  147          * 函 数 名         : LCD12864_Image       
  148          * 函数功能         :用于显示一整张图片
  149          *******************************************************************************/
  150          void LCD12864_Image(uchar *dat)
  151          {
  152   1        uchar i,j;
  153   1        LCD12864_WriteCmd(0x34);  //打开扩充指令
  154   1        //上半屏
  155   1        for(i = 0;i < 32;i++)
  156   1        {
  157   2          LCD12864_WriteCmd(0x80 + i);//x
*** WARNING C188 IN LINE 157 OF ..\Driver\12864.c: 'parameter 1': value truncated
  158   2          LCD12864_WriteCmd(0x80);//y
  159   2          for(j = 0;j < 16;j++) LCD12864_WriteData(*dat++);
  160   2        }
  161   1        //下半屏
  162   1        for(i = 0;i < 32;i++)
  163   1        {
  164   2          LCD12864_WriteCmd(0x80 + i);//x
*** WARNING C188 IN LINE 164 OF ..\Driver\12864.c: 'parameter 1': value truncated
  165   2          LCD12864_WriteCmd(0x88);//y
  166   2          for(j = 0;j < 16;j++) LCD12864_WriteData(*dat++);
  167   2        }
  168   1        LCD12864_WriteCmd(0x36);  //绘图
  169   1        LCD12864_WriteCmd(0x30);  //回到基本指令
  170   1      }
  171          /*******************************************************************************
  172          * 函 数 名         : LCD12864_cls       
  173          * 函数功能         :用于绘画时清屏，不可清除非绘画的显示，例如字
  174          *******************************************************************************/
  175          void LCD12864_cls()
  176          {
  177   1        uchar i,j;
  178   1        LCD12864_WriteCmd(0x34);  //打开扩充指令
  179   1        //上半屏
  180   1        for(i = 0;i < 32;i++)
  181   1        {
  182   2          LCD12864_WriteCmd(0x80 + i);//x
*** WARNING C188 IN LINE 182 OF ..\Driver\12864.c: 'parameter 1': value truncated
  183   2          LCD12864_WriteCmd(0x80);//y
  184   2          for(j = 0;j < 16;j++) LCD12864_WriteData(0x00);
  185   2        }
  186   1        //下半屏
  187   1        for(i = 0;i < 32;i++)
C251 COMPILER V5.60.0,  12864                                                              21/04/24  18:50:23  PAGE 4   

  188   1        {
  189   2          LCD12864_WriteCmd(0x80 + i);//x
*** WARNING C188 IN LINE 189 OF ..\Driver\12864.c: 'parameter 1': value truncated
  190   2          LCD12864_WriteCmd(0x88);//y
  191   2          for(j = 0;j < 16;j++) LCD12864_WriteData(0x00);
  192   2        }
  193   1        LCD12864_WriteCmd(0x36);  //绘图
  194   1        LCD12864_WriteCmd(0x30);  //回到基本指令
  195   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       451     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  4 WARNING(S),  0 ERROR(S)
